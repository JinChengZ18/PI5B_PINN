

## hell 脚本升级：支持任务数 > GPU 数

下面是一个**自动轮转 GPU 分配的 shell 脚本**，可以直接保存为 `train_many.sh`：

```bash
#!/bin/bash

# ================================
# 可用 GPU 列表（你说的是 GPU 1–5）
# ================================
GPUS=(1 2 3 4 5)
NUM_GPUS=${#GPUS[@]}

# ================================
# 所有实验参数列表（可扩展到任意数量）
# ================================
EXPERIMENTS=(
  "--epochs 100 --lr 1e-3   --points_per_case 8192 --log_dir logs/exp01 --ckpt_dir checkpoints/exp01"
  "--epochs 120 --lr 5e-4   --points_per_case 4096 --log_dir logs/exp02 --ckpt_dir checkpoints/exp02"
  "--epochs 80  --lr 2e-3   --points_per_case 10240 --log_dir logs/exp03 --ckpt_dir checkpoints/exp03"
  "--epochs 150 --lr 1e-4   --points_per_case 8192 --log_dir logs/exp04 --ckpt_dir checkpoints/exp04"
  "--epochs 100 --lr 3e-3   --points_per_case 6144 --log_dir logs/exp05 --ckpt_dir checkpoints/exp05"
  "--epochs 90  --lr 2e-4   --points_per_case 4096 --log_dir logs/exp06 --ckpt_dir checkpoints/exp06"
  "--epochs 110 --lr 1e-3   --points_per_case 5120 --log_dir logs/exp07 --ckpt_dir checkpoints/exp07"
  "--epochs 130 --lr 4e-4   --points_per_case 7168 --log_dir logs/exp08 --ckpt_dir checkpoints/exp08"
  "--epochs 95  --lr 6e-4   --points_per_case 8192 --log_dir logs/exp09 --ckpt_dir checkpoints/exp09"
  "--epochs 105 --lr 8e-4   --points_per_case 6144 --log_dir logs/exp10 --ckpt_dir checkpoints/exp10"
)

# ================================
# 启动任务（轮转 GPU 分配）
# ================================
for i in "${!EXPERIMENTS[@]}"; do
  GPU_INDEX=$((i % NUM_GPUS))
  GPU_ID=${GPUS[$GPU_INDEX]}

  echo "Launching experiment $((i+1)) on GPU $GPU_ID"
  CUDA_VISIBLE_DEVICES=$GPU_ID \
  python train.py \
    --num_workers 8 \
    ${EXPERIMENTS[$i]} &

  # 控制并发数量：最多同时运行 NUM_GPUS 个任务
  if (( (i+1) % NUM_GPUS == 0 )); then
    wait
  fi
done

# 等待最后一批任务完成
wait
echo "✅ 所有任务已完成"
```

## 参数空间

当前的参数空间如下：

| 参数              | 水平值（建议）   |
| ----------------- | ---------------- |
| `epochs`          | 80, 100, 120     |
| `lr`              | 1e-4, 5e-4, 1e-3 |
| `points_per_case` | 4096, 6144, 8192 |

这构成一个 **3 × 3 × 3 = 27 个组合** 的全因子设计空间。

### 使用正交表 L9(3³)

这是一个经典的 9 组实验设计，能在保持代表性的同时大幅减少实验数量。

| 实验编号 | epochs | lr   | points_per_case |
| -------- | ------ | ---- | --------------- |
| 1        | 80     | 1e-4 | 4096            |
| 2        | 80     | 5e-4 | 6144            |
| 3        | 80     | 1e-3 | 8192            |
| 4        | 100    | 1e-4 | 6144            |
| 5        | 100    | 5e-4 | 8192            |
| 6        | 100    | 1e-3 | 4096            |
| 7        | 120    | 1e-4 | 8192            |
| 8        | 120    | 5e-4 | 4096            |
| 9        | 120    | 1e-3 | 6144            |









